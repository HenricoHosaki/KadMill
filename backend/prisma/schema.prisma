// backend/prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

// -- MARCAÇÃO DA URL DO BANCO --//
datasource db {
  provider = "postgresql"
  //url = env("DATABASE_URL")
}

// -- ENUMERAÇÕES DO BANCO DE DADOS -- //
enum Funcao {
  OPERADOR
  GERENTE
  ADMIN
}

enum Setor {
  NOTURNO
  DIURNO
}

enum Status {
  ATIVO
  INATIVO
}

// -- TABELAS DO BANDO DA LR USINAGEM -- //
model Usuario {
  id              Int           @id @default(autoincrement())
  nome            String
  email           String        @unique
  senha           String
  cpf             String        @unique @db.Char(11)
  funcao          Funcao        @default(OPERADOR)
  setor           Setor         @default(DIURNO)
  status          Status        @default(ATIVO)
  data_admissao   DateTime      @default(now())
  apontamentosUsuario Apontamento[]
}

model Fornecedor {
    id Int @id @default(autoincrement())
    nome String
    contato String
    cpf_cnpj String @unique
    telefone String
    email String @unique
    endereco String
    observacao String?
    data_cadastro DateTime @default(now())
    materiaPrima MateriaPrima[]
}

model Cliente {
    id Int @id @default(autoincrement())
    nome String 
    email String @unique
    telefone String
    endereco String
    cpf_cnpj String @unique
    data_cadastro DateTime @default(now())
    clienteOrdemServico OrdemServico[]
}

model Ferramenta {
    id Int @id @default(autoincrement())
    nome String
    tipo String
    descricao String
    quantidade_disponivel Int @default(0)
    status Status @default(ATIVO)
    ultima_manutencao DateTime?
    apontamentosFerramenta Apontamento[]
}

enum UnidadeMedida {
    KG
    L
    UN
    M
    CAIXA
}

model MateriaPrima {
    id Int @id @default(autoincrement())
    nome String
    descricao String
    quantidade_disponivel Int @default(0)
    unidade_medida UnidadeMedida
    fornecedor Fornecedor @relation(fields: [fornecedorId], references: [id])
    fornecedorId Int
    ultima_entrada DateTime?
    valor_unitario Decimal @db.Decimal(10,2)
    apontamentosMateriaPrima Apontamento[]
    composicao ProdutoMateriaPrima[]
}

model ProdutoMateriaPrima {
    id Int @id @default(autoincrement())
    produto Produto @relation(fields: [produtoId], references: [id])
    produtoId Int
    materiaPrima MateriaPrima @relation(fields: [materiaPrimaId], references: [id])
    materiaPrimaId Int
    quantidadeNecessaria Float

    @@unique([produtoId, materiaPrimaId])
}

model Produto {
    id Int @id @default(autoincrement())
    nome String
    descricao String?
    tipo String
    modelo String?
    unidade String
    quantidade_estoque Int @default(0)
    preco_unitario Decimal @db.Decimal(10,2)
    custo_unitario Decimal @db.Decimal(10,2)
    data_registro DateTime @default(now())
    composicao ProdutoMateriaPrima[]
}

model OrdemServico {
    id Int @id @default(autoincrement())
    numero_os String @unique
    cliente Cliente @relation(fields: [clienteId], references: [id])
    clienteId Int
    descricao_servico String
    data_abertura DateTime @default(now())
    data_fechamento DateTime?
    status String @default("ABERTA")
    valor_total Decimal @db.Decimal(10,2)
    observacao String?
    
    // --- NOVOS CAMPOS ---
    equipamento_utilizado String?
    tempo_total_execucao Int? @default(0) // Minutos
    executante String?                    // Nome ou ID
    inicio_servico DateTime?
    fim_servico DateTime?
    quantidade_esperada Int? @default(0)
    // --------------------

    apontamentosOrdemServico Apontamento[]
}

model Apontamento {
    id Int @id @default (autoincrement())
    usuario Usuario @relation(fields: [usuarioId], references: [id])
    usuarioId Int
    ordemServico OrdemServico @relation(fields: [ordemServicoId], references: [id])
    ordemServicoId Int
    ferramenta Ferramenta? @relation(fields: [ferramentaId], references: [id])
    ferramentaId Int?
    materiaPrima MateriaPrima? @relation(fields: [materiaPrimaId], references: [id])
    materiaPrimaId Int?
    quantidade_utilizada Int @default(0)
    quantidade_produzida Int @default(0)
    data_apontamento DateTime @default(now())
    tempo_execucao Int @default(0)
    observacao String?

    // --- NOVOS CAMPOS ---
    inicio_trabalho DateTime?
    fim_trabalho DateTime?
    // --------------------
}